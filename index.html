<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FranÃ§aisFacile - Apprendre le FranÃ§ais pour Arabophones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Noto+Sans+Arabic:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Poppins', 'Noto Sans Arabic', sans-serif;
            background-color: #f8fafc;
        }

        .rtl { direction: rtl; }
        .ltr { direction: ltr; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-active {
            border-bottom: 3px solid #3b82f6;
            color: #3b82f6;
        }

        .btn-hover {
            transition: all 0.3s ease;
        }
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2 cursor-pointer" onclick="router.navigate('home')">
                    <div class="bg-blue-600 p-2 rounded-lg text-white">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <span class="text-xl font-bold text-gray-800">FranÃ§ais<span class="text-blue-600">Facile</span></span>
                </div>
                <div class="flex space-x-4">
                    <button onclick="router.setRole('user')" id="btn-user" class="px-4 py-2 rounded-full text-sm font-medium transition-colors bg-blue-100 text-blue-700">Apprenant</button>
                    <button id="btn-user" class="px-4 py-2 rounded-full text-sm font-medium transition-colors bg-blue-100 text-blue-700"><a href="home_ang.html">Anglais</a></button>
                    <button onclick="router.setRole('admin')" id="btn-admin" class="px-4 py-2 rounded-full text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100">Admin</button>
                </div>
            </div>
        </div>
    </nav>

    <main id="app-container" class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Content will be injected here -->
    </main>

    <!-- Modals -->
    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[60] flex items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-300">
            <!-- Modal content injected here -->
        </div>
    </div>

    <!-- <script src="data_stories.js"></script> -->
    <script>
        // --- DATA STRUCTURE & STORAGE ---
        
const INITIAL_DATA = {
            levels: [
                { id: 1, title_fr: 'DÃ©butant', title_ar: 'Ù…Ø¨ØªØ¯Ø¦', icon: 'fa-seedling', color: 'bg-green-500' },
                { id: 2, title_fr: 'IntermÃ©diaire', title_ar: 'Ù…ØªÙˆØ³Ø·', icon: 'fa-tree', color: 'bg-blue-500' },
                { id: 3, title_fr: 'AvancÃ©', title_ar: 'Ù…ØªÙ‚Ø¯Ù…', icon: 'fa-mountain', color: 'bg-purple-500' }
            ],
            stories: [
                

                {
                    id: 1,
                    level_id: 1,
                    title_fr: "1-Le petit dÃ©jeuner de Sarah",
                    title_ar: "ÙØ·ÙˆØ± Ø³Ø§Ø±Ø©",
                    text_fr: "Le matin, Sarah mange une pomme rouge. Elle boit un jus d'orange frais avec son frÃ¨re. Ils sont trÃ¨s heureux avant d'aller Ã  l'Ã©cole.",
                    text_ar: "ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ØŒ Ø³Ø§Ø±Ø© ØªØ£ÙƒÙ„ ØªÙØ§Ø­Ø© Ø­Ù…Ø±Ø§Ø¡. ØªØ´Ø±Ø¨ Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„ Ø·Ø§Ø²Ø¬ Ù…Ø¹ Ø£Ø®ÙŠÙ‡Ø§. Ù‡Ù…Ø§ Ø³Ø¹ÙŠØ¯Ø§Ù† Ø¬Ø¯Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.",
                    vocabulary: [
                        { fr: "Pomme", ar: "ØªÙØ§Ø­Ø©" },
                        { fr: "Matin", ar: "ØµØ¨Ø§Ø­" },
                        { fr: "Heureux", ar: "Ø³Ø¹ÙŠØ¯" },
                        { fr: "Ã‰cole", ar: "Ù…Ø¯Ø±Ø³Ø©" },
                        { fr: "manger", ar: "Ø£ÙƒÙ„" },
                        { fr: "boire", ar: "Ø´Ø±Ø¨" },
                        { fr: "frÃ¨re", ar: "Ø£Ø®" },
                        { fr: "jus d'orange", ar: "Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„" },
                        { fr: "rouge", ar: "Ø£Ø­Ù…Ø±" },
                        { fr: "frais", ar: "Ø·Ø§Ø²Ø¬" },
                        { fr: "avec", ar: "Ù…Ø¹" },
                        { fr: "avant", ar: "Ù‚Ø¨Ù„" },
                        { fr: "aller", ar: "Ø°Ù‡Ø¨" }
                    ],
                    comprehension: [
                        { q: "Que mange Sarah ?", options: ["Une poire", "Une pomme", "Un pain"], correct: 1 },
                        { q: "Avec qui est-elle ?", options: ["Son pÃ¨re", "Son frÃ¨re", "Sa sÅ“ur"], correct: 1 }
                    ],
                    grammar: [
                        { 
                            text: "..... matin, Sarah mange une pomme.", 
                            missing: "Le", 
                            options: ["Le", "La", "Les"], 
                            rule_fr: "L'article dÃ©fini 'Le' est utilisÃ© devant un nom masculin singulier (Matin).",
                            rule_ar: "Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ 'Le' ØªØ³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯ (Matin)."
                        },
                        { 
                            text: "Sarah ..... une pomme rouge.", 
                            missing: "mange", 
                            options: ["mange", "manges", "mangent"], 
                            rule_fr: "Le verbe 'manger' au prÃ©sent avec 'Elle' se termine par -e.",
                            rule_ar: "ÙØ¹Ù„ 'manger' ÙÙŠ Ø§Ù„Ø­Ø§Ø¶Ø± Ù…Ø¹ Ø§Ù„Ø¶Ù…ÙŠØ± 'Elle' ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ -e."
                        },
                        { 
                            text: "Sarah mange ..... pomme rouge.", 
                            missing: "une", 
                            options: ["un", "une", "des"], 
                            rule_fr: "L'article indÃ©fini 'une' est utilisÃ© devant un nom fÃ©minin (Pomme).",
                            rule_ar: "Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ†ÙƒÙŠØ± 'une' ØªØ³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù†Ø« (Pomme)."
                        },
                        { 
                            text: "..... boit un jus d'orange.", 
                            missing: "Elle", 
                            options: ["Il", "Elle", "Ils"], 
                            rule_fr: "On utilise 'Elle' pour remplacer un sujet fÃ©minin (Sarah).",
                            rule_ar: "Ù†Ø³ØªØ®Ø¯Ù… 'Elle' Ù„Ù„ØªØ¹ÙˆÙŠØ¶ Ø¹Ù† ÙØ§Ø¹Ù„ Ù…Ø¤Ù†Ø« (Ø³Ø§Ø±Ø©)."
                        },
                        { 
                            text: "Elle boit ..... jus d'orange.", 
                            missing: "un", 
                            options: ["un", "une", "le"], 
                            rule_fr: "'Un' est l'article indÃ©fini masculin singulier (Jus).",
                            rule_ar: "'Un' Ù‡ÙŠ Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ†ÙƒÙŠØ± Ù„Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯ (Ø¹ØµÙŠØ±)."
                        },
                        { 
                            text: "Elle boit un jus avec ..... frÃ¨re.", 
                            missing: "son", 
                            options: ["mon", "son", "sa"], 
                            rule_fr: "'Son' est l'adjectif possessif pour 'son frÃ¨re' (masculin).",
                            rule_ar: "'Son' Ù‡Ùˆ ØµÙØ© Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„Ù€ 'Ø£Ø®ÙˆÙ‡Ø§' (Ù…Ø°ÙƒØ±)."
                        },
                        { 
                            text: "..... sont trÃ¨s heureux.", 
                            missing: "Ils", 
                            options: ["Il", "Ils", "Elles"], 
                            rule_fr: "'Ils' est le pronom sujet pluriel masculin.",
                            rule_ar: "'Ils' Ù‡Ùˆ Ø¶Ù…ÙŠØ± Ø§Ù„ÙØ§Ø¹Ù„ Ù„Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø°ÙƒØ±."
                        },
                        { 
                            text: "Ils ..... trÃ¨s heureux.", 
                            missing: "sont", 
                            options: ["est", "Ãªtes", "sont"], 
                            rule_fr: "Conjugaison du verbe 'ÃŠtre' : Ils sont.",
                            rule_ar: "ØªØµØ±ÙŠÙ ÙØ¹Ù„ Ø§Ù„ÙƒÙŠÙ†ÙˆÙ†Ø© 'ÃŠtre' Ù…Ø¹ Ø§Ù„Ø¬Ù…Ø¹: Ils sont."
                        },
                        { 
                            text: "Ils sont trÃ¨s .....", 
                            missing: "heureux", 
                            options: ["heureux", "heureuse", "heureuses"], 
                            rule_fr: "L'adjectif s'accorde avec le sujet 'Ils' (masculin pluriel). 'Heureux' ne change pas au pluriel.",
                            rule_ar: "Ø§Ù„ØµÙØ© ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆØµÙˆÙ 'Ils' (Ø¬Ù…Ø¹ Ù…Ø°ÙƒØ±). ÙƒÙ„Ù…Ø© 'Heureux' Ù„Ø§ ØªØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø¬Ù…Ø¹."
                        },
                        { 
                            text: "Ils vont ..... l'Ã©cole.", 
                            missing: "Ã ", 
                            options: ["Ã ", "au", "en"], 
                            rule_fr: "On utilise la prÃ©position 'Ã ' devant un lieu avec l'article dÃ©fini (Ã  l'Ã©cole).",
                            rule_ar: "Ù†Ø³ØªØ®Ø¯Ù… Ø­Ø±Ù Ø§Ù„Ø¬Ø± 'Ã ' Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙƒØ§Ù† Ù…Ø¹ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ (Ã  l'Ã©cole)."
                        }
                    ]
                },
                {
                        id: 2,
                        level_id: 1,
                        title_fr: "2-Une journÃ©e au jardin",
                        title_ar: "ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©",

                        text_fr: "Aujourd'hui, il fait beau. Thomas va au jardin avec son petit chien. Il voit de grandes fleurs et un grand arbre. Il joue au ballon avec ses amis.",
                        text_ar: "Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ù„Ø¬Ùˆ Ø¬Ù…ÙŠÙ„. ØªÙˆÙ…Ø§Ø³ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ù…Ø¹ ÙƒÙ„Ø¨Ù‡ Ø§Ù„ØµØºÙŠØ±. ÙŠØ±Ù‰ Ø²Ù‡ÙˆØ±Ø§Ù‹ ÙƒØ¨ÙŠØ±Ø© ÙˆØ´Ø¬Ø±Ø© ÙƒØ¨ÙŠØ±Ø©. ÙŠÙ„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø© Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ù‡.",

                        vocabulary: [
                        { fr: "Aujourd'hui", ar: "Ø§Ù„ÙŠÙˆÙ…" },
                        { fr: "Beau", ar: "Ø¬Ù…ÙŠÙ„" },
                        { fr: "jardin", ar: "Ø­Ø¯ÙŠÙ‚Ø©" },
                        { fr: "Chien", ar: "ÙƒÙ„Ø¨" },
                        { fr: "Petit", ar: "ØµØºÙŠØ±" },
                        { fr: "Voir", ar: "Ø±Ø£Ù‰" },
                        { fr: "Fleurs", ar: "Ø²Ù‡ÙˆØ±" },
                        { fr: "Arbre", ar: "Ø´Ø¬Ø±Ø©" },
                        { fr: "Jouer", ar: "Ù„Ø¹Ø¨" },
                        { fr: "Ballon", ar: "ÙƒØ±Ø©" },
                        { fr: "Amis", ar: "Ø£ØµØ¯Ù‚Ø§Ø¡" },
                        { fr: "Grand", ar: "ÙƒØ¨ÙŠØ±" },
                        { fr: "Petite", ar: "ØµØºÙŠØ±" },
                        { fr: "Belle", ar: "Ø¬Ù…ÙŠÙ„" },
                        { fr: "Grande", ar: "ÙƒØ¨ÙŠØ±" },
                        ],

                        comprehension: [
                        {
                            q: "Avec qui Thomas va-t-il au jardin ?",options: ["Son chat", "Son chien", "Son frÃ¨re"],
                            correct: 1
                        },
                        {
                            q: "Que voit-il dans le jardin ?",
                            options: ["Des voitures", "Des fleurs", "Des maisons"],
                            correct: 1
                        }
                        ],

                        grammar: [
                        {
                            text: "Aujourd'hui, ..... fait beau.",
                            missing: "il",
                            options: ["il", "elle", "ils"],
                            rule_fr: "On utilise le pronom impersonnel 'il' pour parler de la mÃ©tÃ©o.",
                            rule_ar: "Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¶Ù…ÙŠØ± ØºÙŠØ± Ø§Ù„Ø´Ø®ØµÙŠ 'il' Ù„Ù„ØªØ­Ø¯Ø« Ø¹Ù† Ø§Ù„Ø·Ù‚Ø³."
                        },
                        {
                            text: "Thomas ..... au jardin.",
                            missing: "va",
                            options: ["vais", "vas", "va"],
                            rule_fr: "Le verbe 'aller' Ã  la 3Ã¨me personne du singulier est 'va'.",
                            rule_ar: "ÙØ¹Ù„ 'aller' Ù…Ø¹ Ø§Ù„Ù…ÙØ±Ø¯ Ø§Ù„ØºØ§Ø¦Ø¨ ÙŠÙƒÙˆÙ† 'va'."
                        },
                        {
                            text: "Il va ..... jardin.",
                            missing: "au",
                            options: ["Ã  la", "au", "aux"],
                            rule_fr: "'Au' = Ã  + le devant un nom masculin.",
                            rule_ar: "'Au' Ù‡Ùˆ Ø¯Ù…Ø¬ 'Ã  + le' Ù…Ø¹ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±."
                        },
                        {
                            text: "Il va avec ..... petit chien.",
                            missing: "son",
                            options: ["mon", "ton", "son"],
                            rule_fr: "'Son' est l'adjectif possessif Ã  la 3Ã¨me personne.",
                            rule_ar: "'Son' ØµÙØ© Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ø«Ø§Ù„Ø«."
                        },
                        {
                            text: "Thomas a un ..... chien.",
                            missing: "petit",
                            options: ["petit", "petite", "petits"],
                            rule_fr: "Accord avec le masculin singulier.",
                            rule_ar: "ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯."
                        },
                        {
                            text: "Il voit ..... grandes fleurs.",
                            missing: "de",
                            options: ["des", "de", "les"],
                            rule_fr: "'Des' devient 'de' devant un adjectif.",
                            rule_ar: "'Des' ØªØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ 'de' Ù‚Ø¨Ù„ Ø§Ù„ØµÙØ©."
                        },
                        {
                            text: "Il voit un grand .....",
                            missing: "arbre",
                            options: ["arbre", "arbres", "arbrisseau"],
                            rule_fr: "'Un' impose le singulier.",
                            rule_ar: "'Un' ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØ±Ø¯."
                        },
                        {
                            text: "Il ..... au ballon.",
                            missing: "joue",
                            options: ["joue", "joues", "jouent"],
                            rule_fr: "Avec 'il', le verbe se termine par -e.",
                            rule_ar: "Ù…Ø¹ 'Il' ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ÙØ¹Ù„ Ø¨Ù€ -e."
                        },
                        {
                            text: "Il joue avec ..... amis.",
                            missing: "ses",
                            options: ["son", "sa", "ses"],
                            rule_fr: "'Ses' est le possessif pluriel.",
                            rule_ar: "'Ses' ØµÙØ© Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ø¬Ù…Ø¹."
                        },
                        {
                            text: "Les fleurs sont .....",
                            missing: "grandes",
                            options: ["grand", "grande", "grandes"],
                            rule_fr: "FÃ©minin pluriel.",
                            rule_ar: "Ù…Ø¤Ù†Ø« Ø¬Ù…Ø¹."
                        }
                        ]
                    },
                    {
                    id: 3,
                    level_id: 1,
                    title_fr: "3-Sarah prÃ©pare un gÃ¢teau",
                    title_ar: "Ø³Ø§Ø±Ø© ØªØ­Ø¶Ø± ÙƒØ¹ÙƒØ©",

                    text_fr: "Aujourd'hui, Sarah doit prÃ©parer un gÃ¢teau. Pour cela, il faut des Å“ufs. Comme elle n'en a plus, elle va au marchÃ©. Ensuite, elle rentre Ã  la maison et elle s'y installe pour cuisiner.",
                    text_ar: "Ø§Ù„ÙŠÙˆÙ…ØŒ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø³Ø§Ø±Ø© ØªØ­Ø¶ÙŠØ± ÙƒØ¹ÙƒØ©. ÙˆÙ„Ø°Ù„ÙƒØŒ ÙŠÙ„Ø²Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ¶. Ø¨Ù…Ø§ Ø£Ù†Ù‡ Ù„Ù… ÙŠØ¹Ø¯ Ù„Ø¯ÙŠÙ‡Ø§ Ù…Ù†Ù‡ØŒ ØªØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚. Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŒ ØªØ¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„ ÙˆØªØ³ØªÙ‚Ø± Ù‡Ù†Ø§Ùƒ Ù„Ù„Ø·Ø¨Ø®.",

                    vocabulary: [
                        { fr: "Doit", ar: "ÙŠØ¬Ø¨" },
                        { fr: "PrÃ©parer", ar: "ØªØ­Ø¶ÙŠØ±" },
                        { fr: "GÃ¢teau", ar: "ÙƒØ¹ÙƒØ©" },
                        { fr: "Il faut", ar: "ÙŠØ¬Ø¨ / ÙŠÙ„Ø²Ù…" },
                        { fr: "Oeufs", ar: "Ø¨ÙŠØ¶" },
                        { fr: "En", ar: "Ù…Ù†Ù‡ (Ø¶Ù…ÙŠØ± ØªØ¹ÙˆÙŠØ¶ÙŠ)" },
                        { fr: "MarchÃ©", ar: "Ø³ÙˆÙ‚" },
                        { fr: "Ensuite", ar: "Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ" },
                        { fr: "Maison", ar: "Ù…Ù†Ø²Ù„" },
                        { fr: "Y", ar: "Ù‡Ù†Ø§Ùƒ (Ø¶Ù…ÙŠØ± ØªØ¹ÙˆÙŠØ¶ÙŠ Ù„Ù„Ù…ÙƒØ§Ù†)" },
                        { fr: "S'installer", ar: "ÙŠØ³ØªÙ‚Ø± / ÙŠØ¬Ù„Ø³" },
                        { fr: "Cuisiner", ar: "Ø·Ø¨Ø®" }
                    ],

                    comprehension: [
                        {
                            q: "Que doit faire Sarah ?",
                            options: ["Lire un livre", "PrÃ©parer un gÃ¢teau", "Dormir"],
                            correct: 1
                        },
                        {
                            q: "OÃ¹ va-t-elle pour acheter des Å“ufs ?",
                            options: ["Au cinÃ©ma", "Au parc", "Au marchÃ©"],
                            correct: 2
                        }
                    ],

                    grammar: [
                        {
                            text: "Sarah ..... prÃ©parer un gÃ¢teau.",
                            missing: "doit",
                            options: ["dois", "doit", "doivent"],
                            rule_fr: "Le verbe 'devoir' Ã  la 3Ã¨me personne du singulier est 'doit'.",
                            rule_ar: "ÙØ¹Ù„ 'devoir' Ù…Ø¹ Ø§Ù„Ù…ÙØ±Ø¯ Ø§Ù„ØºØ§Ø¦Ø¨ ÙŠÙƒÙˆÙ† 'doit'."
                        },
                        {
                            text: "Pour cuisiner, il ..... des Å“ufs.",
                            missing: "faut",
                            options: ["faut", "fais", "faut-il"],
                            rule_fr: "'Il faut' est une expression impersonnelle pour exprimer la nÃ©cessitÃ©.",
                            rule_ar: "'Il faut' ØªØ¹Ø¨ÙŠØ± ØºÙŠØ± Ø´Ø®ØµÙŠ Ù„Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ø¶Ø±ÙˆØ±Ø©."
                        },
                        {
                            text: "Elle a besoin d'Å“ufs, elle ..... achÃ¨te.",
                            missing: "en",
                            options: ["le", "la", "en"],
                            rule_fr: "On utilise 'en' pour remplacer une quantitÃ© ou un nom prÃ©cÃ©dÃ© de 'de'.",
                            rule_ar: "Ù†Ø³ØªØ®Ø¯Ù… 'en' Ù„ØªØ¹ÙˆÙŠØ¶ ÙƒÙ…ÙŠØ© Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³Ø¨ÙˆÙ‚ Ø¨Ù€ 'de'."
                        },
                        {
                            text: "Elle va Ã  la maison et elle ..... reste.",
                            missing: "y",
                            options: ["y", "en", "le"],
                            rule_fr: "Le pronom 'y' remplace un lieu (Ã  la maison).",
                            rule_ar: "Ø§Ù„Ø¶Ù…ÙŠØ± 'y' ÙŠØ¹ÙˆØ¶ Ù…ÙƒØ§Ù†Ø§Ù‹ (ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„)."
                        },
                        {
                            text: "Tu ..... finir tes devoirs.",
                            missing: "dois",
                            options: ["dois", "doit", "devons"],
                            rule_fr: "Avec 'tu', le verbe devoir se termine par -s.",
                            rule_ar: "Ù…Ø¹ 'tu'ØŒ ÙŠÙ†ØªÙ‡ÙŠ ÙØ¹Ù„ 'devoir' Ø¨Ù€ -s."
                        },
                        {
                            text: "Il n'y a plus de lait, j'..... achÃ¨te.",
                            missing: "en",
                            options: ["y", "en", "les"],
                            rule_fr: "Ici 'en' remplace 'du lait'.",
                            rule_ar: "Ù‡Ù†Ø§ 'en' ØªØ¹ÙˆØ¶ 'du lait'."
                        },
                        {
                            text: "Est-ce que tu vas au marchÃ© ? Oui, j'..... vais.",
                            missing: "y",
                            options: ["y", "en", "le"],
                            rule_fr: "'Y' remplace 'au marchÃ©'.",
                            rule_ar: "'Y' ØªØ¹ÙˆØ¶ 'au marchÃ©' (Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚)."
                        },
                        {
                            text: "Il ..... travailler pour rÃ©ussir.",
                            missing: "faut",
                            options: ["faut", "doit", "va"],
                            rule_fr: "On utilise 'il faut' suivi d'un infinitif.",
                            rule_ar: "Ù†Ø³ØªØ®Ø¯Ù… 'il faut' Ù…ØªØ¨ÙˆØ¹Ø§Ù‹ Ø¨Ù…ØµØ¯Ø± Ø§Ù„ÙØ¹Ù„."
                        },
                        {
                            text: "Nous ..... partir maintenant.",
                            missing: "devons",
                            options: ["dois", "devons", "doivent"],
                            rule_fr: "Conjugaison de devoir avec 'nous'.",
                            rule_ar: "ØªØµØ±ÙŠÙ 'devoir' Ù…Ø¹ 'nous'."
                        },
                        {
                            text: "Des pommes ? J'..... ai beaucoup.",
                            missing: "en",
                            options: ["les", "en", "y"],
                            rule_fr: "'En' exprime la quantitÃ© ici.",
                            rule_ar: "'En' ØªØ¹Ø¨Ø± Ø¹Ù† Ø§Ù„ÙƒÙ…ÙŠØ© Ù‡Ù†Ø§."
                        }
                    ]


                    },
                    //-------------
                    {
  id: 4,
  level_id: 1,
  title_fr: "4-Le sac de Lina",
  title_ar: "Ø­Ù‚ÙŠØ¨Ø© Ù„ÙŠÙ†Ø§",

  text_fr: "Lina a un sac bleu. Dans son sac, il y a un livre et un stylo. Elle prend le sac pour aller Ã  l'Ã©cole.",
  text_ar: "Ù„ÙŠÙ†Ø§ Ù„Ø¯ÙŠÙ‡Ø§ Ø­Ù‚ÙŠØ¨Ø© Ø²Ø±Ù‚Ø§Ø¡. ÙÙŠ Ø­Ù‚ÙŠØ¨ØªÙ‡Ø§ ÙŠÙˆØ¬Ø¯ ÙƒØªØ§Ø¨ ÙˆÙ‚Ù„Ù…. ØªØ£Ø®Ø° Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© Ù„Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.",

  vocabulary: [
    { fr: "Sac", ar: "Ø­Ù‚ÙŠØ¨Ø©" },
    { fr: "Bleu", ar: "Ø£Ø²Ø±Ù‚" },
    { fr: "Livre", ar: "ÙƒØªØ§Ø¨" },
    { fr: "Stylo", ar: "Ù‚Ù„Ù…" },
    { fr: "Prendre", ar: "Ø£Ø®Ø°" },
    { fr: "Aller", ar: "Ø°Ù‡Ø¨" }
  ],

  comprehension: [
    { q: "De quelle couleur est le sac ?", options: ["Rouge", "Bleu", "Vert"], correct: 1 },
    { q: "Que contient le sac ?", options: ["Un ballon", "Un livre et un stylo", "Des fruits"], correct: 1 }
  ],

  grammar: [
    {
      text: "Lina a ..... sac bleu.",
      missing: "un",
      options: ["un", "une", "des"],
      rule_fr: `
"Un" est lâ€™article indÃ©fini masculin singulier.
â¡ï¸ Sac = nom masculin
â¡ï¸ On utilise "un" quand on parle de quelque chose de non prÃ©cis.
Exemples :
- un sac
- un livre
Exception : devant une voyelle â†’ "un" reste inchangÃ©.
      `,
      rule_ar: `
"Un" Ù‡ÙŠ Ø£Ø¯Ø§Ø© ØªÙ†ÙƒÙŠØ± Ù„Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯.
â¡ï¸ sac Ø§Ø³Ù… Ù…Ø°ÙƒØ±
ØªÙØ³ØªØ¹Ù…Ù„ Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ Ù†Ø­Ø¯Ø¯ Ø§Ù„Ø´ÙŠØ¡.
Ø£Ù…Ø«Ù„Ø©:
- un sac
- un livre
      `
    },
    {
      text: "..... son sac, il y a un livre.",
      missing: "Dans",
      options: ["Dans", "Sur", "Avec"],
      rule_fr: `
"Dans" indique lâ€™intÃ©rieur dâ€™un objet ou dâ€™un lieu.
Exemples :
- Dans la maison
- Dans le sac
âš ï¸ Ne pas confondre avec "sur" (au-dessus).
      `,
      rule_ar: `
"Dans" ØªØ¹Ù†ÙŠ Ø¯Ø§Ø®Ù„ Ø´ÙŠØ¡.
Ø£Ù…Ø«Ù„Ø©:
- Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙŠØª
- Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©
      `
    }
  ]
},
{
  id: 11,
  level_id: 2,
  title_fr: "1-Le week-end de Karim",
  title_ar: "Ø¹Ø·Ù„Ø© ÙƒØ±ÙŠÙ…",

  text_fr: "Samedi, Karim est allÃ© au cinÃ©ma avec ses amis. Ils ont regardÃ© un film intÃ©ressant et ont mangÃ© du pop-corn.",
  text_ar: "ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨ØªØŒ Ø°Ù‡Ø¨ ÙƒØ±ÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ù‡. Ø´Ø§Ù‡Ø¯ÙˆØ§ ÙÙŠÙ„Ù…Ø§Ù‹ Ù…Ù…ØªØ¹Ø§Ù‹ ÙˆØ£ÙƒÙ„ÙˆØ§ ÙØ´Ø§Ø±Ø§Ù‹.",
  vocabulary: [
    { fr: "Samedi", ar: "ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª" },
    { fr: "CinÃ©ma", ar: "Ø³ÙŠÙ†Ù…Ø§" },
    { fr: "Regarder", ar: "Ø´Ø§Ù‡Ø¯" },
    { fr: "Film", ar: "ÙÙŠÙ„Ù…" },
    { fr: "IntÃ©ressant", ar: "Ù…Ù…ØªØ¹" },
    { fr: "Pop-corn", ar: "ÙØ´Ø§Ø±" }
  ],
  comprehension: [
    { q: "OÃ¹ est allÃ© Karim ?", options: ["Au parc", "Au cinÃ©ma", "Au musÃ©e"], correct: 1 },
    { q: "Qu'ont-ils mangÃ© ?", options: ["Des bonbons", "Du pop-corn", "Des fruits"], correct: 1 }
  ],
  grammar: [
    {
      text: "Karim est ..... au cinÃ©ma.",
      missing: "allÃ©",
      options: ["aller", "allÃ©", "allÃ©e"],
      rule_fr: `
Le passÃ© composÃ© avec "Ãªtre" :
Ãªtre + participe passÃ©.
â¡ï¸ Aller se conjugue avec "Ãªtre".
Accord :
- Karim (masculin singulier) â†’ allÃ©
Exemples :
- Elle est allÃ©e
- Ils sont allÃ©s
      `,
      rule_ar: `
Ø§Ù„Ù…Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ Ù…Ø¹ Ãªtre:
Ãªtre + Ø§Ø³Ù… Ø§Ù„Ù…ÙØ¹ÙˆÙ„
Ø§Ù„ÙØ¹Ù„ aller ÙŠØ£ØªÙŠ Ù…Ø¹ Ãªtre
ÙˆÙŠÙØ·Ø§Ø¨Ù‚ Ø§Ù„ÙØ§Ø¹Ù„:
- ÙƒØ±ÙŠÙ… â†’ allÃ©
      `
    }
  ]
},
{
  id: 21,
  level_id: 3,
  title_fr: "1-Un projet important",
  title_ar: "Ù…Ø´Ø±ÙˆØ¹ Ù…Ù‡Ù…",

  text_fr: "Si Marc avait plus de temps, il terminerait son projet plus rapidement, ce qui amÃ©liorerait ses rÃ©sultats.",
  text_ar: "Ù„Ùˆ ÙƒØ§Ù† Ù„Ø¯Ù‰ Ù…Ø§Ø±Ùƒ ÙˆÙ‚Øª Ø£ÙƒØ«Ø±ØŒ Ù„Ø£Ù†Ù‡ÙÙ‰ Ù…Ø´Ø±ÙˆØ¹Ù‡ Ø¨Ø³Ø±Ø¹Ø© Ø£ÙƒØ¨Ø±ØŒ Ù…Ù…Ø§ Ø³ÙŠØ­Ø³Ù† Ù†ØªØ§Ø¦Ø¬Ù‡.",

  grammar: [
    {
      text: "Si Marc ..... plus de temps, il terminerait le projet.",
      missing: "avait",
      options: ["a", "avait", "aurait"],
      rule_fr: `
Structure du conditionnel :
Si + imparfait â†’ conditionnel prÃ©sent
Exemples :
- Si j'avais de l'argent, je voyagerais.
âš ï¸ Jamais : si + conditionnel
      `,
      rule_ar: `
Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø´Ø±Ø·:
Si + imparfait Ø«Ù… conditionnel
Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³ØªØ¹Ù…Ø§Ù„ conditionnel Ø¨Ø¹Ø¯ si
      `
    }
  ]
},
{
  id: 0,
  level_id: 1,
  title_fr: "5-Pourquoi Amine dit Â« je parle Â»",
  title_ar: "Ù„Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ø£Ù…ÙŠÙ† Â« je parle Â»",
  text_fr: "Amine apprend le franÃ§ais. Chaque matin, il parle avec ses amis. Il regarde des vidÃ©os et Ã©coute la radio. Un jour, Amine remarque quelque chose. Il dit : je parle, je regarde, jâ€™Ã©coute. Il comprend alors une rÃ¨gle simple : quand on parle de ce quâ€™on fait maintenant, on utilise le prÃ©sent. Les verbes comme parler, regarder et Ã©couter finissent par -er. Avec je, on enlÃ¨ve -er et on ajoute -e. Amine pratique tous les jours, et le franÃ§ais devient plus facile.",
  text_ar: "Ø£Ù…ÙŠÙ† ÙŠØªØ¹Ù„Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©. ÙƒÙ„ ØµØ¨Ø§Ø­ØŒ ÙŠØªÙƒÙ„Ù… Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ù‡. ÙŠØ´Ø§Ù‡Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆÙŠØ³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ. ÙÙŠ ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø£ÙŠØ§Ù…ØŒ Ù„Ø§Ø­Ø¸ Ø£Ù…ÙŠÙ† Ø´ÙŠØ¦Ù‹Ø§. Ù‚Ø§Ù„: je parleØŒ je regardeØŒ jâ€™Ã©coute. ÙÙÙ‡Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ø³ÙŠØ·Ø©: Ø¹Ù†Ø¯Ù…Ø§ Ù†ØªØ­Ø¯Ø« Ø¹Ù…Ø§ Ù†ÙØ¹Ù„Ù‡ Ø§Ù„Ø¢Ù†ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ø¶Ø±. Ø§Ù„Ø£ÙØ¹Ø§Ù„ Ù…Ø«Ù„ parler Ùˆregarder ÙˆÃ©couter ØªÙ†ØªÙ‡ÙŠ Ø¨Ù€ -er. Ù…Ø¹ je Ù†Ø­Ø°Ù -er ÙˆÙ†Ø¶ÙŠÙ -e. ÙŠØªØ¯Ø±Ù‘Ø¨ Ø£Ù…ÙŠÙ† ÙƒÙ„ ÙŠÙˆÙ…ØŒ ÙˆØªØµØ¨Ø­ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© Ø£Ø³Ù‡Ù„.",

  vocabulary: [
    { fr: "Apprendre", ar: "ÙŠØªØ¹Ù„Ù…" },
    { fr: "Parler", ar: "ÙŠØªÙƒÙ„Ù…" },
    { fr: "Regarder", ar: "ÙŠØ´Ø§Ù‡Ø¯" },
    { fr: "Ã‰couter", ar: "ÙŠØ³ØªÙ…Ø¹" },
    { fr: "Matin", ar: "ØµØ¨Ø§Ø­" },
    { fr: "RÃ¨gle", ar: "Ù‚Ø§Ø¹Ø¯Ø©" },
    { fr: "PrÃ©sent", ar: "Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹" },
    { fr: "Verbe", ar: "ÙØ¹Ù„" },
    { fr: "Maintenant", ar: "Ø§Ù„Ø¢Ù†" },
    { fr: "Pratiquer", ar: "ÙŠØªØ¯Ø±Ù‘Ø¨" },
    { fr: "Facile", ar: "Ø³Ù‡Ù„" },
    { fr: "Amis", ar: "Ø£ØµØ¯Ù‚Ø§Ø¡" },
    { fr: "Radio", ar: "Ø±Ø§Ø¯ÙŠÙˆ" },
    { fr: "Remarque", ar: "Ù„Ø§Ø­Ø¸" },
    { fr: "Quelque chose", ar: "Ø´ÙŠØ¦Ù‹Ø§" },
    { fr: "Alors", ar: "Ø¥Ø°Ø§Ù‹" },
    { fr: "Simple", ar: "Ø¨Ø³ÙŠØ·Ø©" },
    { fr: "Tous les jours", ar: "ÙƒÙ„ ÙŠÙˆÙ…" },
    { fr: "Devient (devenir)", ar: "ØªØµØ¨Ø­" },
    { fr: "Finissent (finir)", ar: "ØªÙ†ØªÙ‡ÙŠ" }
  ],

  comprehension: [
    {
      q: "Quâ€™est-ce quâ€™Amine apprend ?",
      options: ["Lâ€™anglais", "Le franÃ§ais", "Lâ€™arabe"],
      correct: 1
    },
    {
      q: "Quand utilise-t-on le prÃ©sent ?",
      options: [
        "Pour parler du passÃ©",
        "Pour parler du futur",
        "Pour parler de maintenant"
      ],
      correct: 2
    }
  ],

  grammar: [
    {
      text: "Chaque matin, Amine ..... avec ses amis.",
      missing: "parle",
      options: ["parle", "parles", "parlent"],
      rule_fr: "Avec le sujet 'Il', le verbe du 1er groupe au prÃ©sent se termine par -e.",
      rule_ar: "Ù…Ø¹ Ø§Ù„Ø¶Ù…ÙŠØ± 'Il'ØŒ ÙØ¹Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„Ø­Ø§Ø¶Ø± ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ -e."
    },
    {
      text: "Il ..... des vidÃ©os.",
      missing: "regarde",
      options: ["regarde", "regardes", "regardent"],
      rule_fr: "Le verbe 'regarder' au prÃ©sent avec 'Il' prend la terminaison -e.",
      rule_ar: "ÙØ¹Ù„ 'regarder' ÙÙŠ Ø§Ù„Ø­Ø§Ø¶Ø± Ù…Ø¹ 'Il' ÙŠØ£Ø®Ø° Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -e."
    },
    {
      text: "Il ..... la radio.",
      missing: "Ã©coute",
      options: ["Ã©coute", "Ã©coutes", "Ã©coutent"],
      rule_fr: "Pour les verbes en -er, on enlÃ¨ve -er et on ajoute -e avec 'Il'.",
      rule_ar: "ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø¨Ù€ -er Ù†Ø­Ø°Ù -er ÙˆÙ†Ø¶ÙŠÙ -e Ù…Ø¹ 'Il'."
    },
    {
      text: "Je ..... franÃ§ais.",
      missing: "parle",
      options: ["parle", "parles", "parlent"],
      rule_fr: "Avec 'Je', les verbes du 1er groupe au prÃ©sent se terminent par -e.",
      rule_ar: "Ù…Ø¹ 'Je' Ø£ÙØ¹Ø§Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„Ø­Ø§Ø¶Ø± ØªÙ†ØªÙ‡ÙŠ Ø¨Ù€ -e."
    },
    {
      text: "Les verbes ..... par -er.",
      missing: "finissent",
      options: ["finis", "finissent", "finissez"],
      rule_fr: "Avec 'Les verbes' (pluriel), le verbe 'finir' se conjugue 'finissent'.",
      rule_ar: "Ù…Ø¹ Ø§Ù„Ø¬Ù…Ø¹ 'Les verbes' ÙŠÙØµØ±Ù Ø§Ù„ÙØ¹Ù„ 'finir' Ø¥Ù„Ù‰ 'finissent'."
    }
  ]
}


             ]
        };


        //end of data 
        
        //let state = JSON.parse(localStorage.getItem('fr_easy_data')) || INITIAL_DATA;
        let state;
try {
    const savedData = localStorage.getItem('fr_easy_data');
    state = savedData ? JSON.parse(savedData) : INITIAL_DATA;
} catch (e) {
    console.error("LocalStorage non supportÃ©");
    state = INITIAL_DATA; // On utilise les donnÃ©es par dÃ©faut si le stockage plante
}

        //modif new 
        let currentRole = 'user'; 

        function saveData() {
            localStorage.setItem('fr_easy_data', JSON.stringify(state));
        }

        // --- ROUTING & VIEW ENGINE ---
        const router = {
            currentView: 'home',
            params: {},
            
            navigate(view, params = {}) {
                this.currentView = view;
                this.params = params;
                this.render();
                window.scrollTo(0,0);
            },

            setRole(role) {
                currentRole = role;
                document.getElementById('btn-user').className = role === 'user' ? 'px-4 py-2 rounded-full text-sm font-medium transition-colors bg-blue-100 text-blue-700' : 'px-4 py-2 rounded-full text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100';
                document.getElementById('btn-admin').className = role === 'admin' ? 'px-4 py-2 rounded-full text-sm font-medium transition-colors bg-blue-100 text-blue-700' : 'px-4 py-2 rounded-full text-sm font-medium transition-colors text-gray-600 hover:bg-gray-100';
                this.navigate('home');
            },

            render() {
                const container = document.getElementById('app-container');
                if (currentRole === 'admin') {
                    renderAdmin(container, this.currentView, this.params);
                } else {
                    renderUser(container, this.currentView, this.params);
                }
            }
        };

        // --- USER VIEWS ---
        function renderUser(container, view, params) {
            switch(view) {
                case 'home':
                    container.innerHTML = `
                        <div class="text-center mb-10 animate-in slide-in-from-top duration-500">
                            <h1 class="text-4xl font-bold text-gray-900 mb-2">Bienvenue ! ğŸ‘‹</h1>
                            <p class="text-gray-600">Choisissez votre niveau pour commencer l'aventure.</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${state.levels.map(level => `
                                <div onclick="router.navigate('stories', {levelId: ${level.id}})" class="glass-card p-8 rounded-3xl cursor-pointer btn-hover flex flex-col items-center text-center">
                                    <div class="${level.color} w-20 h-20 rounded-2xl flex items-center justify-center text-white text-3xl mb-4 shadow-lg">
                                        <i class="fas ${level.icon}"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800">${level.title_fr}</h3>
                                    <span class="text-lg text-blue-600 font-bold rtl" dir="rtl">${level.title_ar}</span>
                                    <p class="mt-4 text-sm text-gray-500">${state.stories.filter(s => s.level_id === level.id).length} Histoires disponibles</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;

                case 'stories':
                    const level = state.levels.find(l => l.id === params.levelId);
                    const stories = state.stories.filter(s => s.level_id === params.levelId);
                    container.innerHTML = `
                        <div class="mb-6 flex items-center gap-4">
                            <button onclick="router.navigate('home')" class="p-2 hover:bg-gray-200 rounded-full transition-colors">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <h2 class="text-2xl font-bold text-gray-800">${level.title_fr} / ${level.title_ar}</h2>
                        </div>
                        <div class="space-y-4">
                            ${stories.length > 0 ? stories.map(story => `
                                <div onclick="router.navigate('read', {storyId: ${story.id}})" class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-blue-300 transition-all cursor-pointer flex justify-between items-center group">
                                    <div>
                                        <h3 class="text-xl font-semibold text-gray-800">${story.title_fr}</h3>
                                        <p class="text-gray-500 rtl" dir="rtl">${story.title_ar}</p>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-300 group-hover:text-blue-500 transition-colors"></i>
                                </div>
                            `).join('') : '<p class="text-center text-gray-500 py-10">Aucune histoire pour le moment.</p>'}
                        </div>
                    `;
                    break;

                case 'read':
                    const story = state.stories.find(s => s.id === params.storyId);
                    container.innerHTML = `
                        <div class="mb-8 flex justify-between items-center">
                            <button onclick="router.navigate('stories', {levelId: ${story.level_id}})" class="flex items-center gap-2 text-gray-600 hover:text-blue-600">
                                <i class="fas fa-arrow-left"></i> Retour
                            </button>
                            <span class="px-4 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold uppercase tracking-widest">Lecture</span>
                        </div>
                        
                        <div class="bg-white rounded-3xl shadow-xl overflow-hidden mb-8">
                            <div class="p-8 lg:p-12">
                                <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">${story.title_fr}</h1>
                                <div class="space-y-8">
                                    <div class="text-xl leading-relaxed text-gray-800 ltr">
                                        ${story.text_fr}
                                    </div>
                                    <div id="translation" class="hidden animate-in slide-in-from-bottom duration-300">
                                        <hr class="mb-6">
                                        <div class="text-xl leading-relaxed text-blue-800 rtl text-right" dir="rtl">
                                            ${story.text_ar}
                                        </div>
                                    </div>
                                    <div class="flex justify-center">
                                        <button onclick="toggleTranslation()" class="px-6 py-2 bg-blue-50 text-blue-600 rounded-xl font-medium hover:bg-blue-100 transition-colors">
                                            <i class="fas fa-language mr-2"></i> Traduire / ØªØ±Ø¬Ù…Ø©
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-6 grid grid-cols-1 md:grid-cols-3 gap-4 border-t">
                                <button onclick="router.navigate('vocab', {storyId: ${story.id}})" class="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow flex flex-col items-center">
                                    <i class="fas fa-spell-check text-blue-500 text-xl mb-2"></i>
                                    <span class="font-semibold">Vocabulaire</span>
                                </button>
                                <button onclick="router.navigate('quiz_comp', {storyId: ${story.id}})" class="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow flex flex-col items-center">
                                    <i class="fas fa-question-circle text-orange-500 text-xl mb-2"></i>
                                    <span class="font-semibold">ComprÃ©hension</span>
                                </button>
                                <button onclick="router.navigate('quiz_gram', {storyId: ${story.id}})" class="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow flex flex-col items-center">
                                    <i class="fas fa-graduation-cap text-purple-500 text-xl mb-2"></i>
                                    <span class="font-semibold">Grammaire</span>
                                </button>
                            </div>
                        </div>
                    `;
                    break;

                case 'vocab':
                    renderVocabGame(container, params.storyId);
                    break;
                case 'quiz_comp':
                    renderQuiz(container, params.storyId, 'comprehension');
                    break;
                case 'quiz_gram':
                    renderQuiz(container, params.storyId, 'grammar');
                    break;
            }
        }

        // --- GAME LOGIC ---
        function toggleTranslation() {
            const el = document.getElementById('translation');
            el.classList.toggle('hidden');
        }

        function renderVocabGame(container, storyId) {
            const story = state.stories.find(s => s.id === storyId);
            const vocab = story.vocabulary;
            if(!vocab || vocab.length === 0) {
                container.innerHTML = `<div class="text-center p-10"><p>Pas de vocabulaire disponible.</p><button onclick="router.navigate('read', {storyId: ${storyId}})" class="mt-4 text-blue-600 font-bold">Retour</button></div>`;
                return;
            }

            let currentIdx = 0;
            let direction = 'fr-ar';
            
            function showQuestion() {
                const word = vocab[currentIdx];
                const isFrToAr = direction === 'fr-ar';
                const questionWord = isFrToAr ? word.fr : word.ar;
                const correctAns = isFrToAr ? word.ar : word.fr;
                
                let options = [correctAns];
                let otherWords = vocab.filter(v => (isFrToAr ? v.ar : v.fr) !== correctAns);
                otherWords = otherWords.sort(() => 0.5 - Math.random()).slice(0, 2);
                options.push(...otherWords.map(v => isFrToAr ? v.ar : v.fr));
                options = options.sort(() => 0.5 - Math.random());

                container.innerHTML = `
                    <div class="max-w-md mx-auto animate-in fade-in duration-500">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="router.navigate('read', {storyId: ${storyId}})" class="text-gray-500"><i class="fas fa-times"></i> Quitter</button>
                            <span class="font-bold text-blue-600">${currentIdx + 1} / ${vocab.length}</span>
                        </div>
                        <div class="bg-white p-8 rounded-3xl shadow-xl text-center mb-8">
                            <p class="text-gray-500 text-sm mb-2 uppercase tracking-widest">${isFrToAr ? 'Traduire en Arabe' : 'Traduire en FranÃ§ais'}</p>
                            <h2 class="text-4xl font-bold ${!isFrToAr ? 'rtl' : 'ltr'}" ${!isFrToAr ? 'dir="rtl"' : ''}>${questionWord}</h2>
                        </div>
                        <div class="space-y-4">
                            ${options.map(opt => `
                                <button onclick="checkVocab('${opt}', '${correctAns}', ${storyId})" class="w-full p-5 bg-white border-2 border-gray-100 rounded-2xl text-xl font-semibold hover:border-blue-400 hover:bg-blue-50 transition-all text-center ${isFrToAr ? 'rtl' : 'ltr'}" ${isFrToAr ? 'dir="rtl"' : ''}>
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            window.checkVocab = (selected, correct, sId) => {
                if(selected === correct) {
                    currentIdx++;
                    if(currentIdx >= vocab.length) {
                        showSuccess("FÃ©licitations ! Vous avez appris tout le vocabulaire.", sId);
                    } else {
                        showQuestion();
                    }
                } else {
                    showError("Oups ! RÃ©essayez.");
                }
            };

            showQuestion();
        }

        function renderQuiz(container, storyId, type) {
            const story = state.stories.find(s => s.id === storyId);
            const questions = story[type];
            
            if(!questions || questions.length === 0) {
                container.innerHTML = `<div class="text-center p-10"><p>Pas d'exercices disponibles.</p><button onclick="router.navigate('read', {storyId: ${storyId}})" class="mt-4 text-blue-600 font-bold">Retour</button></div>`;
                return;
            }

            let currentIdx = 0;

            function showQuestion() {
                const q = questions[currentIdx];
                container.innerHTML = `
                    <div class="max-w-2xl mx-auto animate-in fade-in duration-500">
                        <div class="mb-6 flex justify-between items-center">
                            <button onclick="router.navigate('read', {storyId: ${storyId}})" class="text-gray-500"><i class="fas fa-times"></i> Quitter</button>
                            <span class="font-bold text-blue-600">${currentIdx + 1} / ${questions.length}</span>
                        </div>
                        <div class="bg-white p-8 rounded-3xl shadow-xl mb-8 relative">
                            <p class="text-gray-400 text-xs mb-4 uppercase tracking-widest">${type === 'grammar' ? 'Grammaire' : 'ComprÃ©hension'}</p>
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">${type === 'grammar' ? q.text : q.q}</h2>
                            
                            ${type === 'grammar' ? `
                                <button onclick="showHelp('${q.rule_fr.replace(/'/g, "\\'")}', '${q.rule_ar.replace(/'/g, "\\'")}')" class="absolute top-6 right-6 text-purple-500 hover:text-purple-700 bg-purple-50 px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1 transition-all">
                                    <i class="fas fa-info-circle"></i> Aide / Ù…Ø³Ø§Ø¹Ø¯Ø©
                                </button>
                            ` : ''}
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            ${q.options.map((opt, idx) => `
                                <button onclick="checkQuiz(${idx}, ${type === 'grammar' ? `'${q.missing}'` : q.correct}, ${storyId}, '${type}')" class="w-full p-5 bg-white border-2 border-gray-100 rounded-2xl text-lg font-medium hover:border-blue-400 hover:bg-blue-50 transition-all text-left flex justify-between items-center">
                                    <span>${opt}</span>
                                    <i class="fas fa-chevron-right text-gray-200"></i>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            window.checkQuiz = (idx, correct, sId, qType) => {
                const q = questions[currentIdx];
                let isCorrect = false;
                if(qType === 'grammar') {
                    isCorrect = q.options[idx] === correct;
                } else {
                    isCorrect = idx === correct;
                }

                if(isCorrect) {
                    currentIdx++;
                    if(currentIdx >= questions.length) {
                        showSuccess("Bravo ! Vous avez terminÃ© cet exercice.", sId);
                    } else {
                        showQuestion();
                    }
                } else {
                    showError("La rÃ©ponse est incorrecte. Consultez l'aide si besoin.");
                }
            };

            showQuestion();
        }

        // --- ADMIN VIEWS ---
        function renderAdmin(container, view, params) {
            container.innerHTML = `
                <div class="flex justify-between items-center mb-10">
                    <h1 class="text-3xl font-bold text-gray-900">Console Admin</h1>
                    <button onclick="showAddLevel()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-blue-700 transition-colors">
                        + Nouveau Niveau
                    </button>
                </div>
                
                <div class="grid grid-cols-1 gap-8">
                    ${state.levels.map(level => `
                        <div class="bg-white rounded-3xl shadow-md border border-gray-100 overflow-hidden">
                            <div class="p-6 bg-gray-50 border-b flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <div class="${level.color} p-3 rounded-xl text-white">
                                        <i class="fas ${level.icon}"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-800">${level.title_fr} / ${level.title_ar}</h2>
                                        <p class="text-sm text-gray-500">${state.stories.filter(s => s.level_id === level.id).length} Histoires</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="addStory(${level.id})" class="text-blue-600 hover:bg-blue-50 px-3 py-1 rounded-lg text-sm font-semibold">Ajouter Histoire</button>
                                    <button onclick="deleteLevel(${level.id})" class="text-red-500 hover:bg-red-50 p-2 rounded-lg"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                            <div class="p-4 space-y-2">
                                ${state.stories.filter(s => s.level_id === level.id).map(story => `
                                    <div class="flex justify-between items-center p-4 border rounded-xl hover:bg-gray-50 group">
                                        <span class="font-medium">${story.title_fr}</span>
                                        <div class="flex gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button onclick="editStoryContent(${story.id})" class="text-blue-500"><i class="fas fa-edit"></i></button>
                                            <button onclick="deleteStory(${story.id})" class="text-red-400"><i class="fas fa-times-circle"></i></button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // --- MODALS & ACTIONS ---
        function showModal(contentHtml) {
            const modal = document.getElementById('modal-container');
            const inner = document.getElementById('modal-content');
            inner.innerHTML = contentHtml;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-container').classList.add('hidden');
        }

        function showAddLevel() {
            showModal(`
                <div class="p-6">
                    <h2 class="text-2xl font-bold mb-6">Ajouter un Niveau</h2>
                    <div class="space-y-4">
                        <input id="lvl-fr" placeholder="Titre FranÃ§ais" type="text" class="w-full p-3 border rounded-xl">
                        <input id="lvl-ar" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" type="text" dir="rtl" class="w-full p-3 border rounded-xl rtl">
                        <div class="flex gap-4 mt-8">
                            <button onclick="closeModal()" class="flex-1 px-4 py-3 bg-gray-100 rounded-xl font-bold">Annuler</button>
                            <button onclick="confirmAddLevel()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold">CrÃ©er</button>
                        </div>
                    </div>
                </div>
            `);
        }

        function confirmAddLevel() {
            const fr = document.getElementById('lvl-fr').value;
            const ar = document.getElementById('lvl-ar').value;
            if(!fr || !ar) return;
            state.levels.push({ id: Date.now(), title_fr: fr, title_ar: ar, icon: 'fa-star', color: 'bg-yellow-500' });
            saveData(); closeModal(); router.render();
        }

        function deleteLevel(id) {
            if(confirm("Supprimer ce niveau ?")) {
                state.levels = state.levels.filter(l => l.id !== id);
                state.stories = state.stories.filter(s => s.level_id !== id);
                saveData(); router.render();
            }
        }

        function addStory(levelId) {
            showModal(`
                <div class="p-6 max-h-[80vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-6">Nouvelle Histoire</h2>
                    <div class="space-y-4">
                        <input id="s-title-fr" placeholder="Titre FranÃ§ais" class="w-full p-3 border rounded-xl">
                        <input id="s-title-ar" dir="rtl" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" class="w-full p-3 border rounded-xl rtl">
                        <textarea id="s-text-fr" placeholder="Texte en FranÃ§ais" class="w-full p-3 border rounded-xl h-32"></textarea>
                        <textarea id="s-text-ar" dir="rtl" placeholder="Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" class="w-full p-3 border rounded-xl h-32 rtl"></textarea>
                        <textarea id="s-vocab" placeholder="Vocabulaire (ex: Pomme=ØªÙØ§Ø­Ø©, Pain=Ø®Ø¨Ø²)" class="w-full p-3 border rounded-xl"></textarea>
                    </div>
                    <div class="flex gap-4 mt-8">
                        <button onclick="closeModal()" class="flex-1 px-4 py-3 bg-gray-100 rounded-xl font-bold">Annuler</button>
                        <button onclick="confirmAddStory(${levelId})" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold">Sauvegarder</button>
                    </div>
                </div>
            `);
        }

        function confirmAddStory(levelId) {
            const vocab = document.getElementById('s-vocab').value.split(',').filter(x => x.includes('=')).map(pair => {
                const [fr, ar] = pair.split('=');
                return { fr: fr.trim(), ar: ar.trim() };
            });
            state.stories.push({
                id: Date.now(), level_id: levelId, 
                title_fr: document.getElementById('s-title-fr').value,
                title_ar: document.getElementById('s-title-ar').value,
                text_fr: document.getElementById('s-text-fr').value,
                text_ar: document.getElementById('s-text-ar').value,
                vocabulary: vocab, comprehension: [], grammar: []
            });
            saveData(); closeModal(); router.render();
        }

        function deleteStory(id) {
            state.stories = state.stories.filter(s => s.id !== id);
            saveData(); router.render();
        }

        function editStoryContent(id) {
            const story = state.stories.find(s => s.id === id);
            showModal(`
                <div class="p-6 max-h-[80vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4">Ã‰diter : ${story.title_fr}</h2>
                    <div class="space-y-6">
                        <div class="bg-blue-50 p-4 rounded-xl">
                            <h3 class="font-bold mb-2">ComprÃ©hension</h3>
                            <button onclick="addMCQ(${id}, 'comprehension')" class="text-sm bg-blue-600 text-white px-3 py-1 rounded">Ajouter Question</button>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-xl">
                            <h3 class="font-bold mb-2">Grammaire</h3>
                            <button onclick="addMCQ(${id}, 'grammar')" class="text-sm bg-purple-600 text-white px-3 py-1 rounded">Ajouter RÃ¨gle</button>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-6 py-3 bg-gray-200 rounded-xl font-bold">Fermer</button>
                </div>
            `);
        }

        function addMCQ(id, type) {
            if(type === 'comprehension') {
                showModal(`
                    <div class="p-6">
                        <h3 class="font-bold mb-4">Question de ComprÃ©hension</h3>
                        <input id="mcq-q" placeholder="Question" class="w-full p-3 border rounded mb-2">
                        <input id="mcq-o1" placeholder="Option 1" class="w-full p-2 border rounded mb-2">
                        <input id="mcq-o2" placeholder="Option 2" class="w-full p-2 border rounded mb-2">
                        <input id="mcq-o3" placeholder="Option 3" class="w-full p-2 border rounded mb-2">
                        <input id="mcq-correct" type="number" placeholder="Index correct (0, 1, 2)" class="w-full p-2 border rounded">
                        <div class="flex gap-2 mt-4">
                            <button onclick="editStoryContent(${id})" class="flex-1 py-2 bg-gray-200 rounded">Retour</button>
                            <button onclick="confirmMCQ(${id}, 'comprehension')" class="flex-1 py-2 bg-blue-600 text-white rounded">Ajouter</button>
                        </div>
                    </div>
                `);
            } else {
                showModal(`
                    <div class="p-6">
                        <h3 class="font-bold mb-4">Exercice de Grammaire</h3>
                        <input id="g-text" placeholder="Phrase Ã  trou" class="w-full p-3 border rounded mb-2">
                        <input id="g-missing" placeholder="RÃ©ponse correcte" class="w-full p-2 border rounded mb-2">
                        <input id="g-o1" placeholder="Faux Choix 1" class="w-full p-2 border rounded mb-2">
                        <input id="g-o2" placeholder="Faux Choix 2" class="w-full p-2 border rounded mb-2">
                        <textarea id="g-rule-fr" placeholder="RÃ¨gle FranÃ§ais" class="w-full p-2 border rounded mb-2"></textarea>
                        <textarea id="g-rule-ar" dir="rtl" placeholder="Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" class="w-full p-2 border rounded mb-2 rtl"></textarea>
                        <div class="flex gap-2 mt-4">
                            <button onclick="editStoryContent(${id})" class="flex-1 py-2 bg-gray-200 rounded">Retour</button>
                            <button onclick="confirmMCQ(${id}, 'grammar')" class="flex-1 py-2 bg-purple-600 text-white rounded">Ajouter</button>
                        </div>
                    </div>
                `);
            }
        }

        function confirmMCQ(id, type) {
            const story = state.stories.find(s => s.id === id);
            if(type === 'comprehension') {
                story.comprehension.push({ 
                    q: document.getElementById('mcq-q').value, 
                    options: [document.getElementById('mcq-o1').value, document.getElementById('mcq-o2').value, document.getElementById('mcq-o3').value],
                    correct: parseInt(document.getElementById('mcq-correct').value)
                });
            } else {
                story.grammar.push({ 
                    text: document.getElementById('g-text').value, 
                    missing: document.getElementById('g-missing').value, 
                    options: [document.getElementById('g-missing').value, document.getElementById('g-o1').value, document.getElementById('g-o2').value].sort(() => 0.5 - Math.random()),
                    rule_fr: document.getElementById('g-rule-fr').value,
                    rule_ar: document.getElementById('g-rule-ar').value
                });
            }
            saveData(); editStoryContent(id);
        }

        // --- UTILS ---
        function showSuccess(msg, sId) {
            showModal(`
                <div class="p-8 text-center">
                    <div class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl"><i class="fas fa-check"></i></div>
                    <h2 class="text-2xl font-bold mb-2">Excellent !</h2>
                    <p class="text-gray-600 mb-6">${msg}</p>
                    <button onclick="closeModal(); router.navigate('read', {storyId: ${sId}})" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold">Continuer</button>
                </div>
            `);
        }

        function showError(msg) {
            showModal(`
                <div class="p-6 text-center">
                    <div class="text-red-500 text-5xl mb-4"><i class="fas fa-times-circle"></i></div>
                    <p class="text-lg font-bold">${msg}</p>
                    <button onclick="closeModal()" class="mt-4 px-6 py-2 bg-gray-100 rounded-lg">RÃ©essayer</button>
                </div>
            `);
        }

        function showHelp(fr, ar) {
            showModal(`
                <div class="p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-lightbulb text-yellow-500 text-2xl"></i>
                        <h2 class="text-2xl font-bold text-gray-800">RÃ¨gle de Grammaire</h2>
                    </div>
                    <div class="space-y-6">
                        <div class="p-5 bg-blue-50 border-l-4 border-blue-500 rounded-r-xl">
                            <span class="text-xs font-bold text-blue-500 uppercase tracking-widest block mb-1">FranÃ§ais</span>
                            <p class="text-blue-900 font-medium text-lg leading-relaxed">${fr}</p>
                        </div>
                        <div class="p-5 bg-purple-50 border-r-4 border-purple-500 rounded-l-xl text-right rtl" dir="rtl">
                            <span class="text-xs font-bold text-purple-500 uppercase tracking-widest block mb-1">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                            <p class="text-purple-900 font-medium text-lg leading-relaxed">${ar}</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-8 py-4 bg-gray-900 text-white rounded-2xl font-bold transition-transform active:scale-95 shadow-lg">J'ai compris !</button>
                </div>
            `);
        }

        window.onload = () => router.render();
    </script>
</body>
</html>